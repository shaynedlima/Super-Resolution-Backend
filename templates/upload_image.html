{% extends "layout.html" %}
{% block title %}Upload Image{% endblock %}
{% block head %}
{{ super() }}
<style type="text/css">
  .important {
    color: #336699;
  }
</style>

<link rel="stylesheet" href="{{ url_for('static', filename='css/uploadImage.css') }}">

{% endblock %}

{% block content %}

{% for message in get_flashed_messages() %}
<div id="alert" class="alert alert-danger">{{ message }}</div>
{% endfor %}


<div id="form" class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center">
  <div class="col-md-5 p-lg-5 mx-auto my-5">
    <h1 class="display-4 font-weight-normal">Upload Image</h1>

    <!-- Uploaded image area-->
    <div class="upload-area">
      <img id="imageResult">
    </div>

    <form action="/upload_image" method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <div class="custom-file">
          <div class="btn purple-button choose-file">
            Choose File
            <input type="file" class="custom-file-input" name="image" id="image" oninput="filesize(this);"
              onchange="readURL(this);" accept="image/*" capture="camera">
          </div>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="defaultCheck1" onchange="agreeTerms()">
          <label class="form-check-label" for="defaultCheck1">
            I agree to the <a class="terms-conditions" data-toggle="modal"
              data-target="#termsModal">privacy policy</a>
          </label>

          <!-- Modal -->
          <div class="modal fade" id="termsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Privacy Policy</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>This application doesn't require registration in order to upload images, thus we do not collect any personally identifiable data.</p> 
                  <p>When images are uploaded, these images will be made publicly accessible for 1 day before being deleted from our servers.</p>
                  <p>This allows anyone who obtains the corresponding link to view the image enhancement results for the particular image.</p> 
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>



        </div>
        <button type="submit" class="upload-button btn purple-button" onClick="loading();">Upload</button>
      </div>

    </form>

  </div>
</div>


<div id="loading">
  <div class="sk-folding-cube">
    <div class="sk-cube1 sk-cube"></div>
    <div class="sk-cube2 sk-cube"></div>
    <div class="sk-cube4 sk-cube"></div>
    <div class="sk-cube3 sk-cube"></div>
  </div>
  <p id="loadingSentences"></p>
</div>


<script>
  function loading() {
    $("#loading").css('visibility', 'visible');
    $("#form").hide();
    $("#alert").hide();
  };

  function filesize(elem) {
    $(".upload-label").text('Change Image');
    document.cookie = `filesize=${elem.files[0].size}`
  }

  var agree = 0;
  function agreeTerms(){
    agree = !agree;
    if(agree){
      $(".upload-button").css('visibility', 'visible');
    }else{
      $(".upload-button").css('visibility', 'hidden');
    }
    
  }

  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();

      reader.onload = function (e) {
        $('#imageResult')
          .attr('src', e.target.result);
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  $(function () {
    $('#upload-label').on('change', function () {
      readURL(input);
    });
  });


  function openModal() {
    $('#termsModal').modal('show');
  }



  var loadingSentences = ["It will be worth the wait...", "Patience is a virtue", "Almost there!"];
  var count = 0;

  function changeSentence() {
    if (count > loadingSentences.length - 1) {
      count = 0;
    }
    document.getElementById("loadingSentences").innerHTML = loadingSentences[count];
    count++
  }

  var inst = setInterval(changeSentence, 3000);

</script>
{% endblock %}